# ミュータブルとイミュータブル ― Web開発で知っておきたい「イミュータビリティ」の重要性

- **学習日**: 2025/06/19
- **学習時間**: 30分
- **効果実感**: 4/5
- **効果の種類**: 理解が深まった

## 内容


# ミュータブルとイミュータブル ― Web開発で知っておきたい「イミュータビリティ」の重要性

## はじめに

プログラミングやWeb開発をしていると、「ミュータブル」「イミュータブル」「イミュータビリティ」という言葉をよく耳にします。  
特にReactやNext.js、状態管理ライブラリを使う現代のフロントエンド開発では、この概念がとても重要です。

この記事では、**ミュータブルとイミュータブルの違い**、**イミュータビリティを意識する理由**、**実践的なメリット・注意点**を整理して解説します。

---

## 1. ミュータブル（mutable）とは？

**ミュータブル**とは「変更可能」という意味です。  
プログラム上で**値そのものを直接書き換えることができる**性質を指します。

### 例：ミュータブルな操作
```js
const arr = [1, 2, 3];
arr.push(4); // arrは[1, 2, 3, 4]に変化（元の配列が書き換わる）
```

- `push`, `pop`, `splice`, `sort`, `reverse` などは**元の配列自体を変更**します。

---

## 2. イミュータブル（immutable）とは？

**イミュータブル**は「不変」という意味です。  
**値そのものは一度作られたら変更されず、変更が必要な場合は新しい値（コピー）を作る**という性質です。

### 例：イミュータブルな操作
```js
const arr = [1, 2, 3];
const newArr = arr.concat(4); // arrはそのまま、newArrは[1, 2, 3, 4]
```

- `map`, `filter`, `concat`, `slice` などは**新しい配列を返し、元の配列は変わりません**。

---

## 3. イミュータビリティ（immutability）とは？

**イミュータビリティ**は「値を不変として扱う設計・考え方」です。  
JavaScript自体はミュータブルな言語ですが、**イミュータブルに扱うことを意識する**ことで、さまざまなメリットがあります。

---

## 4. なぜイミュータビリティが重要なのか？

### 4-1. Reactの再レンダリング最適化

Reactは「propsやstateの**参照が変わったとき**」に再レンダリングします。  
ミュータブルに値を変更すると参照が変わらず、Reactが変更を検知できません。

#### NG例（ミュータブル操作）
```js
state.items.push(newItem); // 参照が変わらないので再レンダリングされない
```

#### OK例（イミュータブル操作）
```js
setState({ items: [...state.items, newItem] }); // 新しい配列で参照が変わる
```

---

### 4-2. バグの予防・予測可能性の向上

ミュータブルな値は「どこで変更されたか分かりにくい」ため、バグの温床になります。  
イミュータブルに扱うことで、**状態の変化が明確**になり、デバッグやテストがしやすくなります。

---

### 4-3. 状態管理ライブラリとの相性

ReduxやZustand、SWR、React Queryなど多くの状態管理ライブラリは、**イミュータビリティを前提**に最適化されています。  
ミュータブル操作をすると、**キャッシュや差分検知が正しく動作しなくなる**ことがあります。

---

### 4-4. パフォーマンス最適化（メモ化・PureComponent等）

`React.memo`や`useMemo`、`useCallback`などのメモ化は、**参照の変化**で最適化されます。  
イミュータブルに扱うことで、**無駄な再計算や再レンダリングを防げます**。

---

### 4-5. バックエンドや大規模開発でも有効

PrismaやTypeORMなどのORM、Redux Toolkit、GraphQLのキャッシュなど、**イミュータビリティを前提とした設計**が多いです。  
複数人開発や大規模開発では、**副作用や意図しない値の変更を防ぐ**ためにもイミュータビリティが推奨されます。

---

## 5. まとめ

- **ミュータブル**＝「値そのものを直接変更できる」
- **イミュータブル**＝「値は不変、変更時は新しい値を作る」
- **イミュータビリティ**を意識することで、バグ予防・パフォーマンス最適化・状態管理の安定化など多くのメリットがある
- ReactやNext.js、状態管理、バックエンド設計でも**イミュータブルな設計が推奨される**

---

### 実践ポイント

- 配列やオブジェクトの更新は**スプレッド構文や`map`/`filter`/`concat`などイミュータブルなメソッドを使う**
- 状態管理やpropsの受け渡しでは**絶対にミュータブル操作を避ける**
- バックエンドでも「値の変更は新しいインスタンスで」を意識する

---

**イミュータビリティを意識した設計・実装で、より安全で予測可能なアプリ開発を目指しましょう！**

---

ご質問や「このケースはどう扱うべき？」などあれば、ぜひコメントください！