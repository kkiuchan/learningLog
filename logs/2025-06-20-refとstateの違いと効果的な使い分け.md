# refとstateの違いと効果的な使い分け

- **学習日**: 2025/06/19
- **学習時間**: 20分
- **効果実感**: 3/5
- **効果の種類**: 理解が深まった

## 内容

# Reactにおけるrefとstateの違いと使い分け

React開発において、「状態の管理」は重要なテーマです。その中でも頻繁に登場するのが `ref` と `state` です。どちらも「値を保持する」仕組みですが、目的や挙動には明確な違いがあります。

---

## 🔰 refとstateの基本的な違い

| 項目     | `state`             | `ref`                       |
| ------ | ------------------- | --------------------------- |
| 目的     | UIの再レンダリングを伴う状態管理   | 再レンダリング不要な値の保持              |
| 変更時の挙動 | 値が変わると再レンダリングされる    | 値が変わっても再レンダリングされない          |
| 主な用途   | フォーム入力、表示制御、トグルなど   | DOM要素の参照、前回値の記録、タイマーIDの保持など |
| 初期化    | `useState(initial)` | `useRef(initial)`           |

---

## 🧠 refとstateの使い分けの目安

* **UIに影響を与える値 → `state`**
* **UIに影響を与えない値（DOM参照・一時的なデータ）→ `ref`**

---

## ✅ 使用例で違いを理解する

### ① ユーザー入力の状態管理（`state`）

```tsx
const [text, setText] = useState('');

return (
   setText(e.target.value)}
  /&gt;
);
```

* 入力値が変わるとコンポーネントが再レンダリングされる。
* ユーザーの入力状態に応じてUIを変化させるために `state` を使う。

### ② inputにフォーカスする（`ref`）

```tsx
const inputRef = useRef(null);

useEffect(() =&gt; {
  inputRef.current?.focus();
}, []);

return ;
```

* 初回レンダリング時に `input` 要素へフォーカスを当てたいだけなら `ref`。
* UI表示には関係ない副作用。

### ③ setIntervalのタイマーID保持（`ref`）

```tsx
const timerRef = useRef(null);

const startTimer = () =&gt; {
  timerRef.current = window.setInterval(() =&gt; {
    console.log('tick');
  }, 1000);
};

const stopTimer = () =&gt; {
  if (timerRef.current) clearInterval(timerRef.current);
};
```

* IDの保持に `state` を使うと不要な再レンダリングが発生する。

---

## 🔍 パフォーマンス面での考慮

* `state` を頻繁に更新すると **再レンダリングが多くなりパフォーマンス低下** につながる。
* 一方 `ref` は更新しても再描画されないため、**パフォーマンスに影響を与えない**。
* 状態を追跡する必要がないケースでは `ref` を優先するのがよい。

---

## 🧩 Reactの仕組みとの関係

* `state` は React の再レンダリングシステムにフックされており、変更時に **仮想DOMの差分検出と描画** が発生します。
* 一方、`ref` は React の再レンダリングとは独立した「ただの箱（コンテナ）」のようなものです。
* `ref.current` の値は **永続的に保持され続けるミュータブルな値** として利用できます。

---

## 🎯 まとめ

| 状態      | 使用方法      | 主な目的            |
| ------- | --------- | --------------- |
| `state` | UIに影響する状態 | 再レンダリングを伴う表示制御  |
| `ref`   | UIに影響しない値 | DOM参照や外部データ保持など |

Reactを深く理解するためには、ただ使うだけでなく「なぜそう設計されているのか？」という仕組みに目を向けることが重要です。`ref` と `state` の適切な使い分けは、Reactのパフォーマンスと可読性を大きく左右します。